app-assistant {
  --assistant-avatar-size: var(--assistant-avatar-size-sm, 48px);
  --assistant-spacing: clamp(12px, 2vw, 18px);
  --assistant-popup-width: clamp(420px, 68vw, 640px);
  --assistant-inline-gap: clamp(16px, 4vw, 28px);
  --assistant-popup-effective-width: min(
    var(--assistant-popup-width),
    calc(100vw - (var(--assistant-inline-gap) * 2))
  );
  --assistant-popup-safe-area-bottom: var(--assistant-safe-area-bottom, 0px);
  --assistant-popup-viewport-margin: calc(
    clamp(72px, 18vh, 132px) + var(--assistant-popup-safe-area-bottom)
  );
  --assistant-popup-max-height: min(
    520px,
    calc(100vh - var(--assistant-popup-viewport-margin))
  );
  --assistant-jump-landing-x: 0px;
  --assistant-jump-landing-y: -168%;
  --assistant-hop-height-strong: clamp(28px, 3.4vw, 38px);
  --assistant-hop-height-medium: clamp(24px, 3vw, 32px);
  --assistant-hop-height-light: clamp(18px, 2.4vw, 26px);
  --assistant-hop-horizontal-big: clamp(28px, 3.6vw, 38px);
  --assistant-hop-horizontal-medium: clamp(20px, 2.8vw, 28px);
  --assistant-hop-horizontal-small: clamp(12px, 2vw, 20px);
  --assistant-avatar-bg: var(
    --assistant-theme-avatar-bg,
    radial-gradient(circle at 30% 30%, #ffe081, #ffb347 55%, #ff8c61 100%)
  );
  --assistant-avatar-shadow-rest: var(--assistant-theme-avatar-shadow-rest, 0 16px 30px #00000040);
  --assistant-avatar-shadow-active: var(--assistant-theme-avatar-shadow-active, 0 20px 32px #00000047);
  --assistant-floor-shadow-color: var(--assistant-theme-floor-shadow-color, #0f172a59);
  --assistant-floor-shadow-color-strong: var(--assistant-theme-floor-shadow-color-strong, #0f172a73);
  --assistant-floor-shadow-size: clamp(28px, 7vw, 42px);
  --assistant-avatar-focus-ring: var(--assistant-theme-avatar-focus-ring, #ffffffcc);
  --assistant-avatar-face-shadow: var(--assistant-theme-avatar-face-shadow, drop-shadow(0 4px 6px #00000040));
  --assistant-avatar-outline-fill: var(--assistant-theme-avatar-outline-fill, #fffffff0);
  --assistant-avatar-eye-color: var(--assistant-theme-avatar-eye-color, #2c3e50);
  --assistant-avatar-smile-color: var(--assistant-theme-avatar-smile-color, #ff8c61);
  --assistant-avatar-wave-border: var(--assistant-theme-avatar-wave-border, #ffffffa6);
  --assistant-popup-bg: var(--assistant-theme-popup-bg, #161d31eb);
  --assistant-popup-color: var(--assistant-theme-popup-color, #f8fafc);
  --assistant-popup-shadow: var(--assistant-theme-popup-shadow, 0 18px 42px #0f172a66);
  --assistant-popup-border: var(--assistant-theme-popup-border, 1px solid transparent);
  display: block;
  max-width: 100%;
}

:host-context(.navigator-wrapper__assistant) app-assistant,
.navigator-wrapper__assistant app-assistant {
  --assistant-popup-width: clamp(280px, 56vw, 360px);
  --assistant-inline-gap: clamp(12px, 3vw, 20px);
  --assistant-popup-effective-width: min(
    var(--assistant-popup-width),
    calc(100% - (var(--assistant-inline-gap) * 2))
  );
}

app-assistant .assistant {
  position: absolute;
  bottom: 0;
  left: auto;
  right: 0;
  display: flex;
  align-items: flex-end;
  justify-content: flex-end;
  pointer-events: none;
  min-height: var(--assistant-avatar-size);
  min-width: var(--assistant-popup-effective-width);
}

:host-context(.navigator-wrapper__assistant) app-assistant .assistant,
.navigator-wrapper__assistant app-assistant .assistant {
  position: relative;
  bottom: auto;
  left: auto;
  right: auto;
  min-width: 0;
  width: 100%;
}

app-assistant .assistant__anchor {
  position: relative;
  width: var(--assistant-avatar-size);
  height: var(--assistant-avatar-size);
  pointer-events: auto;
  z-index: 3;
}

app-assistant .assistant__avatar {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  display: grid;
  place-items: center;
  background: var(--assistant-avatar-bg);
  box-shadow: var(--assistant-avatar-shadow-rest);
  transition: box-shadow 0.35s ease;
  outline: none;
  z-index: 3;
  will-change: transform;
  font-size: 0;
}

app-assistant .assistant__avatar:focus-visible {
  box-shadow: 0 0 0 3px var(--assistant-avatar-focus-ring), var(--assistant-avatar-shadow-rest);
}

app-assistant .assistant__shadow {
  position: absolute;
  inset-inline-start: 50%;
  inset-block-end: -18px;
  width: var(--assistant-floor-shadow-size);
  max-width: 160%;
  aspect-ratio: 3 / 1;
  border-radius: 50%;
  background: radial-gradient(
    circle at center,
    var(--assistant-floor-shadow-color-strong) 0%,
    var(--assistant-floor-shadow-color) 55%,
    transparent 80%
  );
  transform: translate3d(-50%, 0, 0) scale(0.8);
  opacity: 0.35;
  filter: blur(0.5px);
  transition: opacity 0.35s ease, transform 0.35s ease;
  pointer-events: none;
  z-index: 2;
  will-change: transform, opacity;
}

app-assistant .assistant__avatar-face {
  width: 72%;
  height: 72%;
  filter: var(--assistant-avatar-face-shadow, drop-shadow(0 4px 6px #00000040));
}

app-assistant .assistant__avatar-outline {
  fill: var(--assistant-avatar-outline-fill);
}

app-assistant .assistant__avatar-eye-open {
  fill: var(--assistant-avatar-eye-color);
  transition: opacity 0.3s ease, transform 0.3s ease;
}

app-assistant .assistant__avatar-eye-closed {
  fill: none;
  stroke: var(--assistant-avatar-eye-color);
  stroke-width: 4px;
  stroke-linecap: round;
  opacity: 0;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

app-assistant .assistant__avatar-smile {
  fill: none;
  stroke: var(--assistant-avatar-smile-color);
  stroke-width: 6px;
  stroke-linecap: round;
  stroke-linejoin: round;
}

app-assistant .assistant__avatar-wave {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  border: 2px dashed transparent;
  border-color: var(--assistant-avatar-wave-border);
  opacity: 0;
  pointer-events: none;
}

app-assistant .assistant__popup {
  position: absolute;
  right: 0;
  bottom: calc(100% + var(--assistant-spacing));
  width: var(--assistant-popup-effective-width);
  background: var(--assistant-popup-bg);
  color: var(--assistant-popup-color);
  border-radius: 20px;
  padding: 1.25rem 1.25rem 1.5rem;
  box-shadow: var(--assistant-popup-shadow);
  border: var(--assistant-popup-border);
  pointer-events: auto;
  backdrop-filter: blur(8px);
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  max-height: var(--assistant-popup-max-height);
  overflow: hidden;
  z-index: 2;
}

app-assistant .assistant__header {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
}

app-assistant .assistant__content {
  position: relative;
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  min-height: 0;
  overflow: hidden;
}

app-assistant .assistant__content::after {
  content: '';
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 3rem;
  pointer-events: none;
  background: linear-gradient(180deg, rgba(22, 29, 49, 0) 0%, var(--assistant-popup-bg) 88%);
  opacity: 0;
  transition: opacity 0.35s ease;
}

app-assistant .assistant__content--scrollable::after {
  opacity: 0.85;
}

app-assistant .assistant__content--scrollable.assistant__content--at-end::after {
  opacity: 0;
}

app-assistant .assistant__content-scroll {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
  padding-inline-end: clamp(0.4rem, 2vw, 0.65rem);
  margin-inline-end: calc(clamp(0.4rem, 2vw, 0.65rem) * -1);
  scrollbar-width: none;
  -ms-overflow-style: none;
}

app-assistant .assistant__content-scroll::-webkit-scrollbar {
  display: none;
}

app-assistant .assistant__title {
  font-size: clamp(1.05rem, 1.5vw, 1.2rem);
  font-weight: 600;
  margin: 0;
}


app-assistant .assistant__intro,
app-assistant .assistant__closing {
  margin: 0;
  line-height: 1.5;
  font-size: clamp(0.95rem, 1.4vw, 1.05rem);
}

app-assistant .assistant__steps {
  margin: 0;
  padding-left: 1.1rem;
  display: grid;
  gap: 0.45rem;
  font-size: clamp(0.95rem, 1.4vw, 1.05rem);
}

app-assistant .assistant__steps li {
  line-height: 1.45;
}

@media (max-width: 768px) {
  app-assistant {
    --assistant-mobile-viewport-height: 100vh;
    --assistant-mobile-anchor-footprint: 148px;
    --assistant-mobile-safe-area-bottom: var(--assistant-safe-area-bottom, 0px);
    --assistant-mobile-viewport-buffer: clamp(20px, 6vh, 36px);
  }

  @supports (height: 100dvh) {
    app-assistant {
      --assistant-mobile-viewport-height: 100dvh;
    }
  }

  @supports (height: 100svh) {
    app-assistant {
      --assistant-mobile-viewport-height: 100svh;
    }
  }

  app-assistant .assistant__content {
    max-height: min(
      420px,
      max(
        180px,
        calc(
          var(--assistant-mobile-viewport-height, 100vh) -
            var(--assistant-mobile-anchor-footprint, 148px) -
            var(--assistant-mobile-safe-area-bottom, 0px) -
            var(--assistant-mobile-viewport-buffer, 24px)
        )
      )
    );
    overflow: hidden;
  }

  app-assistant .assistant__content-scroll {
    overflow-y: auto;
    padding-inline-end: 0.45rem;
    margin-inline-end: -0.45rem;
    scrollbar-width: none;
    -ms-overflow-style: none;
    touch-action: pan-y;
    -webkit-overflow-scrolling: touch;
    padding-bottom: calc(0.75rem + var(--assistant-mobile-safe-area-bottom, 0px));
  }

  app-assistant .assistant__content-scroll::-webkit-scrollbar {
    display: none;
  }
}

app-assistant .assistant--phase-sleeping .assistant__avatar {
  animation: assistant-sleep 3.5s ease-in-out infinite;
}

app-assistant .assistant--phase-sleeping .assistant__avatar-wave {
  animation: assistant-sleep-wave 4s ease-in-out infinite;
  opacity: 0.45;
}

app-assistant .assistant--phase-sleeping .assistant__avatar-eye-open {
  opacity: 0;
  transform: translateY(4px) scaleY(0.2);
}

app-assistant .assistant--phase-sleeping .assistant__avatar-eye-closed {
  opacity: 1;
}

app-assistant .assistant--phase-sleeping .assistant__shadow {
  opacity: 0.28;
  transform: translate3d(-50%, 0, 0) scale(0.7);
}

app-assistant .assistant--phase-waking .assistant__avatar {
  animation: assistant-wake 0.6s ease-out forwards;
}

app-assistant .assistant--phase-waking .assistant__avatar-eye-open {
  transform: translateY(-2px) scaleY(1.05);
}

app-assistant .assistant--phase-waking .assistant__shadow {
  animation: assistant-shadow-wake 0.6s ease-out forwards;
}

app-assistant .assistant--phase-jumping .assistant__avatar {
  animation: assistant-jump 1.4s cubic-bezier(0.18, 0.54, 0.26, 1) forwards;
}

app-assistant .assistant--phase-jumping .assistant__shadow {
  animation: assistant-shadow-jump 1.4s cubic-bezier(0.18, 0.54, 0.26, 1) forwards;
}

app-assistant .assistant--phase-wondering .assistant__avatar {
  transform: translate3d(var(--assistant-jump-landing-x), var(--assistant-jump-landing-y), 0);
  animation: assistant-landing-hops 2.4s ease-out forwards;
}

app-assistant .assistant--phase-wondering .assistant__avatar-smile {
  animation: assistant-landing-hops-smile 2.4s ease-in-out forwards;
}

app-assistant .assistant--phase-wondering .assistant__avatar-eye-open {
  transform: translateY(-3px) scaleY(1.02);
}

app-assistant .assistant--phase-wondering .assistant__shadow {
  animation: assistant-shadow-landing-hops 2.4s ease-out forwards;
}

app-assistant .assistant--phase-perched .assistant__avatar {
  transform: translate3d(var(--assistant-jump-landing-x), var(--assistant-jump-landing-y), 0) scale(1);
  box-shadow: var(--assistant-avatar-shadow-active);
}

app-assistant .assistant--phase-perched .assistant__shadow {
  opacity: 0.45;
  transform: translate3d(
      calc(-50% + var(--assistant-jump-landing-x)),
      calc(var(--assistant-jump-landing-y) * -1),
      0
    )
    scale(0.98);
}

app-assistant .assistant--phase-falling .assistant__avatar {
  animation: assistant-fall 0.98s cubic-bezier(0.12, 0.02, 0.32, 1) forwards;
}

app-assistant .assistant--phase-falling .assistant__shadow {
  animation: assistant-shadow-fall 0.98s cubic-bezier(0.12, 0.02, 0.32, 1) forwards;
}

app-assistant .assistant__closing {
  opacity: 0.75;
  transition: opacity 0.3s ease;
}

app-assistant .assistant__closing--active {
  opacity: 1;
  animation: assistant-closing-pulse 1.4s ease-in-out infinite;
}

@keyframes assistant-sleep {
  0%,
  100% {
    transform: translateY(0) scale(1);
    box-shadow: var(--assistant-avatar-shadow-rest);
  }

  50% {
    transform: translateY(-6px) scale(0.97);
    box-shadow: var(--assistant-avatar-shadow-active);
  }
}

@keyframes assistant-sleep-wave {
  0%,
  100% {
    opacity: 0.45;
    transform: scale(0.95);
  }

  50% {
    opacity: 0.9;
    transform: scale(1.1);
  }
}

@keyframes assistant-wake {
  0% {
    transform: translateY(0) scale(1);
  }

  40% {
    transform: translateY(-18px) scale(1.08);
  }

  70% {
    transform: translateY(6px) scale(0.96);
  }

  100% {
    transform: translateY(0) scale(1);
  }
}

@keyframes assistant-jump {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
    box-shadow: var(--assistant-avatar-shadow-rest);
  }

  6% {
    transform: translate3d(-6px, 12px, 0) scaleX(1.15) scaleY(0.88);
    box-shadow: var(--assistant-avatar-shadow-active);
  }

  12% {
    transform: translate3d(-10px, 16px, 0) scaleX(1.18) scaleY(0.84);
    box-shadow: var(--assistant-avatar-shadow-active);
  }

  32% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) * 0.35),
        calc(var(--assistant-jump-landing-y) * 0.18 - 110px)
      ),
      scaleX(0.88) scaleY(1.12);
  }

  55% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) * 0.78),
        calc(var(--assistant-jump-landing-y) * 0.72 - 28px)
      ),
      scaleX(0.92) scaleY(1.08);
  }

  78% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) * 1.04),
        calc(var(--assistant-jump-landing-y) * 1.02 + 10px)
      ),
      scaleX(1.1) scaleY(0.9);
  }

  92% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) * 0.96),
        calc(var(--assistant-jump-landing-y) * 0.96 - 12px)
      ),
      scaleX(0.95) scaleY(1.05);
  }

  100% {
    transform: translate3d(var(--assistant-jump-landing-x), var(--assistant-jump-landing-y), 0) scale(1);
    box-shadow: var(--assistant-avatar-shadow-active);
  }
}

@keyframes assistant-landing-hops {
  0% {
    transform: translate3d(var(--assistant-jump-landing-x), var(--assistant-jump-landing-y), 0) scale(1);
    box-shadow: var(--assistant-avatar-shadow-active);
  }

  4% {
    transform: translate3d(
        var(--assistant-jump-landing-x),
        calc(var(--assistant-jump-landing-y) + 12px),
        0
      )
      scaleX(1.12) scaleY(0.9);
  }

  10% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-small)),
        calc(var(--assistant-jump-landing-y) - var(--assistant-hop-height-light)),
        0
      )
      scaleX(0.94) scaleY(1.06);
  }

  16% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-small)),
        var(--assistant-jump-landing-y),
        0
      )
      scale(1);
  }

  20% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-small)),
        calc(var(--assistant-jump-landing-y) + 10px),
        0
      )
      scaleX(1.1) scaleY(0.9);
  }

  26% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-medium)),
        calc(var(--assistant-jump-landing-y) - var(--assistant-hop-height-medium)),
        0
      )
      scaleX(0.92) scaleY(1.08);
  }

  32% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-medium)),
        var(--assistant-jump-landing-y),
        0
      )
      scale(1);
  }

  36% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-medium)),
        calc(var(--assistant-jump-landing-y) + 10px),
        0
      )
      scaleX(1.1) scaleY(0.9);
  }

  42% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-big)),
        calc(var(--assistant-jump-landing-y) - var(--assistant-hop-height-strong)),
        0
      )
      scaleX(0.9) scaleY(1.1);
  }

  48% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-big)),
        var(--assistant-jump-landing-y),
        0
      )
      scale(1);
  }

  52% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-big)),
        calc(var(--assistant-jump-landing-y) + 9px),
        0
      )
      scaleX(1.08) scaleY(0.92);
  }

  58% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-medium)),
        calc(var(--assistant-jump-landing-y) - var(--assistant-hop-height-medium)),
        0
      )
      scaleX(0.93) scaleY(1.07);
  }

  64% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-medium)),
        var(--assistant-jump-landing-y),
        0
      )
      scale(1);
  }

  68% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-medium)),
        calc(var(--assistant-jump-landing-y) + 8px),
        0
      )
      scaleX(1.06) scaleY(0.94);
  }

  74% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-small)),
        calc(var(--assistant-jump-landing-y) - var(--assistant-hop-height-light)),
        0
      )
      scaleX(0.95) scaleY(1.05);
  }

  80% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-small)),
        var(--assistant-jump-landing-y),
        0
      )
      scale(1);
  }

  84% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-small)),
        calc(var(--assistant-jump-landing-y) + 6px),
        0
      )
      scaleX(1.05) scaleY(0.95);
  }

  90% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) + 6px),
        calc(var(--assistant-jump-landing-y) - var(--assistant-hop-height-light)),
        0
      )
      scaleX(0.96) scaleY(1.04);
  }

  100% {
    transform: translate3d(var(--assistant-jump-landing-x), var(--assistant-jump-landing-y), 0) scale(1);
    box-shadow: var(--assistant-avatar-shadow-active);
  }
}

@keyframes assistant-landing-hops-smile {
  0%,
  16%,
  32%,
  48%,
  64%,
  80%,
  100% {
    stroke-width: 6px;
  }

  8%,
  26%,
  42%,
  58%,
  74%,
  90% {
    stroke-width: 7px;
  }
}

@keyframes assistant-fall {
  0% {
    transform: translate3d(
        var(--assistant-jump-landing-x),
        var(--assistant-jump-landing-y),
        0
      )
      scaleX(0.96) scaleY(1.04);
    box-shadow: var(--assistant-avatar-shadow-active);
  }

  20% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) * 0.94),
        calc(var(--assistant-jump-landing-y) * 0.94 + 8px)
      ),
      scaleX(1.08) scaleY(0.92);
  }

  40% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) * 0.75),
        calc(var(--assistant-jump-landing-y) * 0.75 + 26px)
      ),
      scaleX(1.04) scaleY(0.96);
  }

  65% {
    transform: translate3d(
        calc(var(--assistant-jump-landing-x) * 0.35),
        calc(var(--assistant-jump-landing-y) * 0.35 + 52px)
      ),
      scaleX(0.92) scaleY(1.08);
  }

  88% {
    transform: translate3d(0, 18px, 0) scaleX(1.16) scaleY(0.86);
  }

  100% {
    transform: translate3d(0, 0, 0) scale(1);
    box-shadow: var(--assistant-avatar-shadow-rest);
  }
}

@keyframes assistant-shadow-wake {
  0% {
    opacity: 0.28;
    transform: translate3d(-50%, 0, 0) scale(0.7);
  }

  50% {
    opacity: 0.18;
    transform: translate3d(-50%, 0, 0) scale(0.6);
  }

  100% {
    opacity: 0.3;
    transform: translate3d(-50%, 0, 0) scale(0.75);
  }
}

@keyframes assistant-shadow-jump {
  0% {
    opacity: 0.3;
    transform: translate3d(-50%, 0, 0) scale(0.75);
  }

  12% {
    opacity: 0.24;
    transform: translate3d(
        -50%,
        calc(var(--assistant-jump-landing-y) * -0.08),
        0
      ) scale(0.62);
  }

  32% {
    opacity: 0.12;
    transform: translate3d(
        calc(-50% + (var(--assistant-jump-landing-x) * 0.35)),
        calc(var(--assistant-jump-landing-y) * -0.18),
        0
      ) scale(0.38);
  }

  55% {
    opacity: 0.4;
    transform: translate3d(
        calc(-50% + (var(--assistant-jump-landing-x) * 0.78)),
        calc(var(--assistant-jump-landing-y) * -0.72),
        0
      ) scale(1);
  }

  78% {
    opacity: 0.48;
    transform: translate3d(
        calc(-50% + (var(--assistant-jump-landing-x) * 1.04)),
        calc(var(--assistant-jump-landing-y) * -1.02),
        0
      ) scale(1.12);
  }

  92% {
    opacity: 0.36;
    transform: translate3d(
        calc(-50% + (var(--assistant-jump-landing-x) * 0.96)),
        calc(var(--assistant-jump-landing-y) * -0.96),
        0
      ) scale(0.86);
  }

  100% {
    opacity: 0.38;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x)),
        calc(var(--assistant-jump-landing-y) * -1),
        0
      ) scale(0.9);
  }
}

@keyframes assistant-shadow-landing-hops {
  0% {
    opacity: 0.36;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x)),
        calc(var(--assistant-jump-landing-y) * -1),
        0
      ) scale(0.9);
  }

  10% {
    opacity: 0.28;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-small)),
        calc(var(--assistant-jump-landing-y) * -1 + var(--assistant-hop-height-light)),
        0
      ) scale(0.8);
  }

  26% {
    opacity: 0.32;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-medium)),
        calc(var(--assistant-jump-landing-y) * -1 + var(--assistant-hop-height-medium)),
        0
      ) scale(0.85);
  }

  42% {
    opacity: 0.38;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-big)),
        calc(var(--assistant-jump-landing-y) * -1 + var(--assistant-hop-height-strong)),
        0
      ) scale(0.94);
  }

  58% {
    opacity: 0.34;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-medium)),
        calc(var(--assistant-jump-landing-y) * -1 + var(--assistant-hop-height-medium)),
        0
      ) scale(0.88);
  }

  74% {
    opacity: 0.3;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x) - var(--assistant-hop-horizontal-small)),
        calc(var(--assistant-jump-landing-y) * -1 + var(--assistant-hop-height-light)),
        0
      ) scale(0.82);
  }

  90% {
    opacity: 0.38;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x) + 6px),
        calc(var(--assistant-jump-landing-y) * -1 + 6px),
        0
      ) scale(0.94);
  }

  100% {
    opacity: 0.36;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x)),
        calc(var(--assistant-jump-landing-y) * -1),
        0
      ) scale(0.9);
  }
}

@keyframes assistant-shadow-fall {
  0% {
    opacity: 0.36;
    transform: translate3d(
        calc(-50% + var(--assistant-jump-landing-x)),
        calc(var(--assistant-jump-landing-y) * -1),
        0
      ) scale(0.92);
  }

  20% {
    opacity: 0.48;
    transform: translate3d(
        calc(-50% + (var(--assistant-jump-landing-x) * 0.94)),
        calc(var(--assistant-jump-landing-y) * -0.94),
        0
      ) scale(1.12);
  }

  40% {
    opacity: 0.3;
    transform: translate3d(
        calc(-50% + (var(--assistant-jump-landing-x) * 0.75)),
        calc(var(--assistant-jump-landing-y) * -0.75),
        0
      ) scale(0.82);
  }

  65% {
    opacity: 0.46;
    transform: translate3d(
        calc(-50% + (var(--assistant-jump-landing-x) * 0.35)),
        calc(var(--assistant-jump-landing-y) * -0.35),
        0
      ) scale(1.08);
  }

  88% {
    opacity: 0.36;
    transform: translate3d(
        -50%,
        calc(var(--assistant-jump-landing-y) * -0.12),
        0
      ) scale(0.9);
  }

  100% {
    opacity: 0.32;
    transform: translate3d(-50%, 0, 0) scale(0.8);
  }
}

@keyframes assistant-closing-pulse {
  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.55;
  }
}

@media (max-width: 768px) {
  app-assistant {
    --assistant-avatar-size: var(--assistant-avatar-size-sm, 48px);
    --assistant-inline-gap: clamp(12px, 5vw, 18px);
    --assistant-popup-width: min(90vw, 420px);
    --assistant-popup-effective-width: min(
      var(--assistant-popup-width),
      calc(100vw - (var(--assistant-inline-gap) * 2))
    );
    --assistant-popup-viewport-margin: calc(
      clamp(88px, 24vh, 148px) + var(--assistant-popup-safe-area-bottom)
    );
  }

  app-assistant .assistant {
    min-width: var(--assistant-popup-effective-width);
  }

  app-assistant .assistant__popup {
    right: var(--assistant-inline-gap);
    padding: 1rem 1rem 1.25rem;
  }
}
