<aside class="timeline-nav" role="navigation" aria-label="Section timeline"
  [style.--timeline-progress]="progressPercentage + '%'">
  <header class="timeline-header">
    <div class="timeline-summary">
      <span class="timeline-current-index" aria-hidden="true">
        {{ (activeSection?.index ?? 0) + 1 | number: '2.0-0' }}
      </span>
      <div class="timeline-current-info">
        <span class="timeline-current-label">{{ activeSection?.label }}</span>
        <span class="timeline-total" aria-label="Total sections">/{{ totalSections }}</span>
      </div>
    </div>

    <div class="timeline-actions">
      <div class="action-group">
        <button class="action-button" type="button" (click)="toggleThemeOptions()"
          [attr.aria-label]="getTooltip('theme')" [attr.aria-expanded]="showThemeOptions"
          matTooltip="{{ getTooltip('theme') }}" matTooltipPosition="below">
          <mat-icon>{{ getThemeIcon(currentTheme) }}</mat-icon>
        </button>
        <div class="action-menu" *ngIf="showThemeOptions">
          <button class="menu-item" type="button" (click)="changeTheme('light')"
            [class.is-active]="currentTheme === 'light'" aria-label="Light theme">
            <mat-icon>light_mode</mat-icon>
          </button>
          <button class="menu-item" type="button" (click)="changeTheme('dark')"
            [class.is-active]="currentTheme === 'dark'" aria-label="Dark theme">
            <mat-icon>dark_mode</mat-icon>
          </button>
          <button class="menu-item" type="button" (click)="changeTheme('blue')"
            [class.is-active]="currentTheme === 'blue'" aria-label="Blue theme">
            <mat-icon>water_drop</mat-icon>
          </button>
          <button class="menu-item" type="button" (click)="changeTheme('green')"
            [class.is-active]="currentTheme === 'green'" aria-label="Green theme">
            <mat-icon>eco</mat-icon>
          </button>
        </div>
      </div>

      <div class="action-group">
        <button class="action-button" type="button" (click)="toggleLanguageOptions()"
          [attr.aria-label]="getTooltip('language')" [attr.aria-expanded]="showLanguageOptions"
          matTooltip="{{ getTooltip('language') }}" matTooltipPosition="below">
          <span class="lang-label">{{ currentLang | slice:0:3 | uppercase }}</span>
        </button>
        <div class="action-menu" *ngIf="showLanguageOptions">
          <button class="menu-item" type="button" (click)="changeLanguage('en')"
            [class.is-active]="currentLang === 'en'" aria-label="English">
            <span class="lang-flag">ðŸ‡¬ðŸ‡§</span>
          </button>
          <button class="menu-item" type="button" (click)="changeLanguage('it')"
            [class.is-active]="currentLang === 'it'" aria-label="Italiano">
            <span class="lang-flag">ðŸ‡®ðŸ‡¹</span>
          </button>
          <button class="menu-item" type="button" (click)="changeLanguage('de')"
            [class.is-active]="currentLang === 'de'" aria-label="Deutsch">
            <span class="lang-flag">ðŸ‡©ðŸ‡ª</span>
          </button>
          <button class="menu-item" type="button" (click)="changeLanguage('es')"
            [class.is-active]="currentLang === 'es'" aria-label="EspaÃ±ol">
            <span class="lang-flag">ðŸ‡ªðŸ‡¸</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <button class="timeline-arrow" type="button" (click)="onPrevious()" [disabled]="currentSectionIndex === 0"
    [attr.aria-label]="getTooltip('prev')" matTooltip="{{ getTooltip('prev') }}" matTooltipPosition="left">
    <mat-icon>arrow_upward</mat-icon>
  </button>

  <div class="timeline-track">
    <div class="timeline-progress">
      <div class="timeline-progress-bar"></div>
    </div>

    <ol class="timeline-steps">
      <li *ngFor="let section of sectionItems; trackBy: trackBySection">
        <button class="timeline-step" type="button" (click)="onSelectSection(section.index)"
          [class.is-active]="section.index === currentSectionIndex"
          [attr.aria-current]="section.index === currentSectionIndex ? 'step' : null"
          matTooltip="{{ section.label }}" matTooltipPosition="left">
          <span class="timeline-marker" aria-hidden="true">{{ section.index + 1 }}</span>
          <span class="timeline-label">{{ section.label }}</span>
        </button>
      </li>
    </ol>
  </div>

  <button class="timeline-arrow" type="button" (click)="onNext()"
    [disabled]="currentSectionIndex === totalSections - 1"
    [attr.aria-label]="getTooltip('next')" matTooltip="{{ getTooltip('next') }}" matTooltipPosition="left">
    <mat-icon>arrow_downward</mat-icon>
  </button>
</aside>
