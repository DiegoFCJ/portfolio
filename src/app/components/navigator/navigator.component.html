<!-- Floating toggle button -->
<button class="nav-toggle-button" *ngIf="!isOpen" (click)="toggleNavigator()" aria-label="Open navigator">
  <mat-icon>chevron_left</mat-icon>
</button>

<!-- Modern, animated, circular floating navbar -->
<div class="modern-navigator" *ngIf="isOpen">
  <div class="arrow-container">
    <!-- Previous button -->
    <button class="arrow-button" (click)="onPrevious()" aria-label="Previous section"
      [matTooltip]="getTooltip('prev')" matTooltipPosition="left">
      <mat-icon>arrow_upward</mat-icon>
    </button>

    <!-- Next button -->
    <button class="arrow-button" (click)="onNext()" aria-label="Next section"
      [matTooltip]="getTooltip('next')" matTooltipPosition="left">
      <mat-icon>arrow_downward</mat-icon>
    </button>
  </div>

  <div class="nav-group">
    <button class="nav-button" (click)="toggleThemeOptions()" aria-label="Theme selector"
      [matTooltip]="getTooltip('theme')" matTooltipPosition="left">
      <mat-icon>{{ getThemeIcon(currentTheme) }}</mat-icon>
    </button>
    <div class="option-container" *ngIf="showThemeOptions">
      <button class="option-button" (click)="changeTheme('light')" aria-label="Light mode"
        [class.selected]="currentTheme === 'light'">
        <mat-icon>light_mode</mat-icon>
      </button>
      <button class="option-button" (click)="changeTheme('dark')" aria-label="Dark mode"
        [class.selected]="currentTheme === 'dark'">
        <mat-icon>dark_mode</mat-icon>
      </button>
      <button class="option-button" (click)="changeTheme('blue')" aria-label="Blue mode"
        [class.selected]="currentTheme === 'blue'">
        <mat-icon>water_drop</mat-icon>
      </button>
      <button class="option-button" (click)="changeTheme('green')" aria-label="Green mode"
        [class.selected]="currentTheme === 'green'">
        <mat-icon>eco</mat-icon>
      </button>
    </div>
  </div>

  <div class="nav-group">
    <button class="nav-button" (click)="toggleLanguageOptions()" [matTooltip]="getTooltip('language')"
      matTooltipPosition="left">
      <span class="lang-label">{{ currentLang | slice:0:3 | uppercase }}</span>
    </button>
    <div class="option-container" *ngIf="showLanguageOptions">
      <button class="option-button" (click)="changeLanguage('en')" aria-label="English">
        <span class="lang-flag">ðŸ‡¬ðŸ‡§</span>
      </button>
      <button class="option-button" (click)="changeLanguage('it')" aria-label="Italiano">
        <span class="lang-flag">ðŸ‡®ðŸ‡¹</span>
      </button>
      <button class="option-button" (click)="changeLanguage('de')" aria-label="Deutsch">
        <span class="lang-flag">ðŸ‡©ðŸ‡ª</span>
      </button>
      <button class="option-button" (click)="changeLanguage('es')" aria-label="EspaÃ±ol">
        <span class="lang-flag">ðŸ‡ªðŸ‡¸</span>
      </button>
    </div>
  </div>
</div>

<!-- Command palette overlay -->
<div class="command-palette-overlay" *ngIf="isPaletteOpen">
  <div class="command-palette-backdrop" (click)="closePalette()" aria-hidden="true"></div>
  <div class="command-palette-panel" #palettePanel role="dialog" aria-modal="true" aria-label="Command palette"
    (keydown)="handlePaletteKeydown($event)" (click)="$event.stopPropagation()">
    <div class="command-palette-header">
      <mat-icon class="search-icon">search</mat-icon>
      <input #searchInput class="command-palette-input" type="text" [(ngModel)]="searchTerm"
        placeholder="Type a command" aria-label="Search commands" />
      <button class="command-palette-close" type="button" (click)="closePalette()" aria-label="Close command palette">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="command-palette-hint">
      <span>Use â†‘ â†“ to navigate, Enter to select</span>
      <span class="command-palette-shortcut">ESC</span>
    </div>

    <div class="command-list" role="list">
      <ng-container *ngIf="groupedFilteredCommands as groups">
        <ng-container *ngIf="groups.length; else emptyState">
          <div class="command-group" *ngFor="let group of groups">
            <h3 class="command-group-title">{{ group.group }}</h3>
            <button class="command-item" type="button" *ngFor="let command of group.commands"
              (click)="executeCommand(command)" data-command-button>
              <mat-icon class="command-item-icon">{{ command.icon }}</mat-icon>
              <span class="command-item-label">{{ command.label }}</span>
            </button>
          </div>
        </ng-container>
      </ng-container>
      <ng-template #emptyState>
        <p class="command-empty">No commands found</p>
      </ng-template>
    </div>
  </div>
</div>
