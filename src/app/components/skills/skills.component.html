<section class="skills-section" *ngIf="!isLoading">
  <h2 class="skills-title">{{ skillFullTitle }}</h2>

  <ng-container *ngIf="isMobile; else desktopLayout">
    <div class="mobile-layout">
      <nav
        #stackTabs
        class="stack-tabs is-mobile"
        role="tablist"
        aria-orientation="horizontal"
        [attr.aria-label]="stackSelectorLabel"
      >
        <button
          *ngFor="let tab of tabs"
          type="button"
          class="stack-tab"
          role="tab"
          [id]="'tab-' + tab.id"
          [attr.aria-controls]="'panel-' + tab.id"
          [attr.aria-selected]="tab.id === activeTabId"
          [class.active]="tab.id === activeTabId"
          (click)="setActiveTab(tab.id)"
        >
          <span class="tab-label">{{ tab.label }}</span>
        </button>
      </nav>

      <div
        class="carousel-container"
        role="tabpanel"
        [attr.id]="'panel-' + activeTabId"
        [attr.aria-labelledby]="'tab-' + activeTabId"
        [attr.aria-live]="activePanels.length ? 'polite' : 'off'"
        *ngIf="activePanels.length"
      >
        <div class="carousel-wrapper" [style.transform]="'translateX(-' + currentIndex * 100 + '%)'">
          <article
            *ngFor="let panel of activePanels; let i = index"
            class="carousel-item"
            [class.active]="i === currentIndex"
            role="group"
            [attr.aria-roledescription]="'slide'"
            [attr.aria-label]="panel.title"
          >
            <div class="spotlight-card is-mobile" data-skill-host>
              <div class="spotlight-content">
                <p class="spotlight-subtitle" *ngIf="panel.subtitle">{{ panel.subtitle }}</p>
                <div class="spotlight-icons" role="list">
                  <div
                    *ngFor="let skill of panel.skills"
                    class="skill-icon"
                    role="listitem"
                    data-skill-host
                    [attr.aria-label]="skill.name"
                    [class.clicked]="skill.clicked"
                    (click)="onSkillClick(skill)"
                  >
                    <span class="icon-asset">
                      <img [src]="skill.icon" [alt]="skill.name" />
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </article>
        </div>
      </div>

      <div class="carousel-controls" *ngIf="activePanels.length">
        <div
          class="carousel-progress"
          role="status"
          aria-live="polite"
          [attr.aria-label]="getCarouselProgressLabel()"
        >
          {{ currentIndex + 1 }} / {{ activePanels.length }}
        </div>

        <div class="carousel-controls__group">
          <button
            type="button"
            class="carousel-control carousel-control--previous"
            (click)="moveToPrevious()"
            [attr.aria-label]="getCarouselControlLabel('previous')"
            [disabled]="activePanels.length <= 1"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
            </svg>
          </button>

          <button
            type="button"
            class="carousel-control carousel-control--next"
            (click)="moveToNext()"
            [attr.aria-label]="getCarouselControlLabel('next')"
            [disabled]="activePanels.length <= 1"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M8.59 16.59 10 18l6-6-6-6-1.41 1.41L13.17 12z" />
            </svg>
          </button>

          <button
            type="button"
            class="carousel-control carousel-control--back-to-tabs"
            (click)="scrollToTabs()"
            [attr.aria-label]="getCarouselControlLabel('backToTabs')"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
              <path d="M7.41 15.41 12 10.83l4.59 4.58L18 14l-6-6-6 6z" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #desktopLayout>
    <div class="skills-grid">
      <div class="nav-container">
        <nav
          class="stack-tabs"
          role="tablist"
          aria-orientation="vertical"
          [attr.aria-label]="stackSelectorLabel"
        >
          <button
            *ngFor="let tab of tabs"
            type="button"
            class="stack-tab"
            role="tab"
            [id]="'tab-' + tab.id"
            [attr.aria-controls]="'panel-' + tab.id"
            [attr.aria-selected]="tab.id === activeTabId"
            [class.active]="tab.id === activeTabId"
            (click)="setActiveTab(tab.id)"
          >
            <span class="tab-label">{{ tab.label }}</span>
          </button>
        </nav>
      </div>

      <div
        class="spotlight-panels"
        role="tabpanel"
        [attr.aria-labelledby]="'tab-' + activeTabId"
        [attr.id]="'panel-' + activeTabId"
      >
        <article class="spotlight-card" *ngFor="let panel of activePanels" data-skill-host>
          <div class="spotlight-content">
            <p class="spotlight-subtitle" *ngIf="panel.subtitle">{{ panel.subtitle }}</p>
            <div class="spotlight-icons" role="list">
              <div
                *ngFor="let skill of panel.skills"
                class="skill-icon"
                role="listitem"
                data-skill-host
                [attr.aria-label]="skill.name"
                [class.clicked]="skill.clicked"
                (click)="onSkillClick(skill)"
              >
                <span class="icon-asset">
                  <img [src]="skill.icon" [alt]="skill.name" />
                </span>
              </div>
            </div>
          </div>
        </article>
      </div>
    </div>
  </ng-template>
</section>
