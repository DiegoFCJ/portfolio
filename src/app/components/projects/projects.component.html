<section *ngIf="!isLoading" #projectsSection class="projects-section">
    <h2 class="projects-title">{{ projects.title }}</h2>

    <!-- Carosello per mobile -->
    <div class="carousel-container" *ngIf="isMobile" [class.is-peeking]="shouldPeek">
        <div class="carousel-viewport" role="listbox" tabindex="0" [attr.aria-label]="projects.title"
            (scroll)="handleCarouselInteraction()" (touchstart)="handleCarouselInteraction()"
            (mousedown)="handleCarouselInteraction()">
            <div class="carousel-wrapper">
                <div class="carousel-item" *ngFor="let project of projects.projects; let i = index" role="option"
                    [attr.aria-label]="project.title">
                    <ng-container *ngTemplateOutlet="projectCard; context: { $implicit: project, index: i }"></ng-container>
                </div>
            </div>
        </div>
    </div>

    <!-- Griglia per desktop -->
    <div class="project-cards" *ngIf="!isMobile">
        <ng-container *ngFor="let project of projects.projects; let i = index">
            <ng-container *ngTemplateOutlet="projectCard; context: { $implicit: project, index: i }"></ng-container>
        </ng-container>
    </div>

    <ng-template #projectCard let-project let-i="index">
        <article class="project-card" [attr.data-status-level]="project.status.level">
            <div class="project-visual">
                <img class="proj-image" [src]="project.image" [attr.alt]="'Anteprima del progetto ' + project.title" />
            </div>

            <div class="project-header">
                <h3 class="project-title">{{ project.title }}</h3>
                <div class="project-status-wrapper">
                    <span class="project-status-pill">
                        <span class="status-prefix">{{ projects.statusLegend.prefix }}</span>
                        <span class="status-level">{{ getStatusLevelLabel(project.status.level) }}</span>
                    </span>
                    <ul class="project-status-tags" *ngIf="project.status.tags?.length">
                        <li class="status-tag" *ngFor="let tag of project.status.tags">
                            {{ getStatusTagLabel(tag) }}
                        </li>
                    </ul>
                </div>
            </div>

            <p class="project-technologies">{{ project.technologies.join(' · ') }}</p>

            <div class="project-links" *ngIf="project.links as links">
                <div class="project-link" *ngIf="links.code as codeLink">
                    <a *ngIf="isLinkAvailable(codeLink)" class="project-link-anchor" [href]="codeLink.url"
                        target="_blank" rel="noopener noreferrer">
                        {{ projects.linksLegend.code.label }}
                    </a>
                    <span *ngIf="isLinkPrivate(codeLink)" class="project-link-chip">
                        {{ projects.linksLegend.code.privateLabel }}
                    </span>
                    <span *ngIf="isLinkComingSoon(codeLink)" class="project-link-chip is-subtle">
                        {{ projects.linksLegend.code.comingSoonLabel }}
                    </span>
                    <span *ngIf="isLinkUnavailable(codeLink)" class="project-link-chip is-subtle">
                        {{ projects.linksLegend.code.unavailableLabel }}
                    </span>
                </div>

                <div class="project-link" *ngIf="links.preview as previewLink">
                    <a *ngIf="isLinkAvailable(previewLink)" class="project-link-anchor" [href]="previewLink.url"
                        target="_blank" rel="noopener noreferrer">
                        {{ projects.linksLegend.preview.label }}
                    </a>
                    <span *ngIf="isLinkComingSoon(previewLink)" class="project-link-chip is-subtle">
                        {{ projects.linksLegend.preview.comingSoonLabel }}
                    </span>
                    <span *ngIf="isLinkUnavailable(previewLink)" class="project-link-chip is-subtle">
                        {{ projects.linksLegend.preview.unavailableLabel }}
                    </span>
                </div>
            </div>

            <div class="project-description" [class.is-scrollable]="project.isScrollable"
                [class.is-at-end]="project.isAtEnd">
                <div class="description-content" #descriptionContent [attr.id]="'project-description-' + i" tabindex="0"
                    role="region" [attr.aria-label]="project.title + ' — dettagli'"
                    (scroll)="onDescriptionScroll(project, $event)">
                    <p>{{ project.description }}</p>
                </div>
            </div>
        </article>
    </ng-template>
</section>
