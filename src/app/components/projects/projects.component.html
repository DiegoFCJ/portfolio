<section *ngIf="!isLoading" #projectsSection class="projects-section">
    <header class="projects-header section-heading">
        <span class="statistics-title-accent" aria-hidden="true"></span>
        <h2 class="projects-title">{{ projects.title }}</h2>
    </header>

    <!-- Carosello per mobile -->
    <div class="carousel-container" *ngIf="isMobile" [class.is-peeking]="shouldPeek">
        <div class="carousel-viewport" role="listbox" tabindex="0" [attr.aria-label]="projects.title"
            (scroll)="handleCarouselInteraction()" (touchstart)="handleCarouselInteraction()"
            (mousedown)="handleCarouselInteraction()">
            <div class="carousel-wrapper">
                <div class="carousel-item" *ngFor="let project of projects.projects; let i = index" role="option"
                    [attr.aria-label]="project.title">
                    <ng-container *ngTemplateOutlet="projectCard; context: { $implicit: project, index: i }"></ng-container>
                </div>
            </div>
        </div>
    </div>

    <!-- Griglia per desktop -->
    <div class="project-cards" *ngIf="!isMobile">
        <ng-container *ngFor="let project of projects.projects; let i = index">
            <ng-container *ngTemplateOutlet="projectCard; context: { $implicit: project, index: i }"></ng-container>
        </ng-container>
    </div>

    <ng-template #projectCard let-project let-i="index">
        <article class="project-card" [attr.data-status-level]="project.status.level">
            <div class="project-visual">
                <img class="proj-image" [src]="project.image" [attr.alt]="projects.imageAltPrefix + project.title" />
            </div>

            <div class="project-header">
                <h3 class="project-title">{{ project.title }}</h3>
                <div class="project-status-wrapper">
                    <span class="project-status-pill">
                        <span class="status-prefix">{{ projects.statusLegend.prefix }}</span>
                        <span class="status-level">{{ getStatusLevelLabel(project.status.level) }}</span>
                    </span>
                    <ul class="project-status-tags" *ngIf="project.status.tags?.length">
                        <li class="status-tag" *ngFor="let tag of project.status.tags">
                            {{ getStatusTagLabel(tag) }}
                        </li>
                    </ul>
                </div>
            </div>

            <p class="project-technologies">{{ project.technologies.join(' · ') }}</p>

            <div class="project-description" [class.is-scrollable]="project.isScrollable"
                [class.is-at-end]="project.isAtEnd">
                <div class="description-content" #descriptionContent [attr.id]="'project-description-' + i" tabindex="0"
                    role="region" [attr.aria-label]="project.title + ' — dettagli'"
                    (scroll)="onDescriptionScroll(project, $event)">
                    <p>{{ project.description }}</p>
                </div>
            </div>

            <div class="project-details-bar">
                <div class="project-detail">
                    <ng-container [ngSwitch]="getCodeState(project.links)">
                        <a *ngSwitchCase="'available'" class="project-detail-anchor"
                            [href]="getCodeUrl(project.links)" target="_blank" rel="noopener noreferrer">
                            {{ projects.linksLegend.code.availableLabel }}
                        </a>
                        <span *ngSwitchCase="'private'" class="project-detail-label">
                            {{ projects.linksLegend.code.privateLabel }}
                        </span>
                        <span *ngSwitchDefault class="project-detail-label is-muted">
                            {{ projects.linksLegend.code.unavailableLabel }}
                        </span>
                    </ng-container>
                </div>

                <div class="project-detail">
                    <ng-container *ngIf="hasAvailableSite(project.links); else checkDemo">
                        <a class="project-detail-anchor" [href]="getSiteUrl(project.links)" target="_blank"
                            rel="noopener noreferrer">
                            {{ projects.linksLegend.preview.siteLabel }}
                        </a>
                    </ng-container>
                    <ng-template #checkDemo>
                        <ng-container *ngIf="hasAvailableDemo(project.links); else previewUnavailable">
                            <a class="project-detail-anchor" [href]="getDemoUrl(project.links)" target="_blank"
                                rel="noopener noreferrer">
                                {{ projects.linksLegend.preview.demoLabel }}
                            </a>
                        </ng-container>
                    </ng-template>
                    <ng-template #previewUnavailable>
                        <span class="project-detail-label is-muted">
                            {{ projects.linksLegend.preview.unavailableLabel }}
                        </span>
                    </ng-template>
                </div>
            </div>
        </article>
    </ng-template>
</section>
